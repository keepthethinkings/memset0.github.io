<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">
	<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" name="viewport">
	<title>单调队列 - blue's blog</title>

	<!-- css -->
	<link href="/css/base.min.css" rel="stylesheet">
	<link href="/css/project.min.css" rel="stylesheet">
	<link href="/css/styles.css" rel="stylesheet">


	<script type="text/x-mathjax-config">
  		MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
	</script>
	<script src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</head>
<body class="page-brand">
	
	<nav class="menu menu-left nav-drawer nav-drawer-md" id="ui_menu">
		<div class="menu-scroll">
			<div class="menu-content">
				<a class="menu-logo" href="/">blue的博客</a>
				<ul class="nav">
					<li>

						<a class="collapsed waves-attach waves-effect" data-toggle="collapse" href="#posts">OI笔记</a>	
						<ul class="menu-collapse collapse in" id="posts">
							
							<li>
								<a class="waves-attach" href="/post/特征方程.html">特征方程教程</a>
							</li><li>
								<a class="waves-attach" href="/post/近似算法.html">近似算法</a>
							</li><li>
								<a class="waves-attach" href="/post/SG函数.html">SG函数</a>
							</li><li>
								<a class="waves-attach" href="/post/Matrix-Tree.html">Matrix-Tree定理</a>
							</li><li>
								<a class="waves-attach" href="/post/polya.html">polya定理</a>
							</li><li>
								<a class="waves-attach" href="/post/NOIP2016.html">NOIP2016游记</a>
							</li><li>
								<a class="waves-attach" href="/post/有限微积分.html">差分与有限微积分</a>
							</li><li>
								<a class="waves-attach" href="/post/概率论.html">概率论</a>
							</li><li>
								<a class="waves-attach" href="/post/博弈论.html">博弈论入门</a>
							</li><li>
								<a class="waves-attach" href="/post/级数相关.html">级数相关</a>
							</li><li>
								<a class="waves-attach" href="/post/母函数.html">浅谈母函数</a>
							</li><li>
								<a class="waves-attach" href="/post/FFT.html">FFT入门</a>
							</li><li>
								<a class="waves-attach" href="/post/三分查找.html">三分查找</a>
							</li><li>
								<a class="waves-attach" href="/post/Miller_Rabin.html">Miller_Rabin判素</a>
							</li><li>
								<a class="waves-attach" href="/post/HNSDFZ-Round4酱油记.html">HNSDFZ#4 酱油记</a>
							</li><li>
								<a class="waves-attach" href="/post/牛顿迭代.html">牛顿迭代法</a>
							</li><li>
								<a class="waves-attach" href="/post/泰勒展开.html">泰勒展开</a>
							</li><li>
								<a class="waves-attach" href="/post/狄利克雷卷积.html">狄利克雷卷积</a>
							</li><li class="active">
								<a class="waves-attach" href="/post/单调队列.html">单调队列</a>
							</li><li>
								<a class="waves-attach" href="/post/数值积分算法.html">数值积分算法</a>
							</li><li>
								<a class="waves-attach" href="/post/字符串hash.html">字符串hash</a>
							</li><li>
								<a class="waves-attach" href="/post/MEET-IN-THE-MIDDLE.html">Meet in the Middle</a>
							</li><li>
								<a class="waves-attach" href="/post/定积分.html">定积分与牛顿-莱布尼兹公式</a>
							</li><li>
								<a class="waves-attach" href="/post/HNSDFZ-Round3胡策记.html">HNSDFZ#3 胡策记</a>
							</li><li>
								<a class="waves-attach" href="/post/数学归纳法.html">数学归纳法</a>
							</li><li>
								<a class="waves-attach" href="/post/导数.html">导数</a>
							</li><li>
								<a class="waves-attach" href="/post/普通线段树.html">普通线段树</a>
							</li><li>
								<a class="waves-attach" href="/post/矩阵与递推.html">矩阵与递推</a>
							</li>						</ul>

						<a class="collapsed waves-attach waves-effect" data-toggle="collapse" href="#hack">渗透日志</a>	
						<ul class="menu-collapse collapse in" id="hack">
							
							<li>
								<a class="waves-attach" href="/hack/XSS.html">初探XSS</a>
							</li>						</ul>

					</li>
					
				</ul>
			</div>
		</div>
	</nav>
	<header class="header header-transparent header-waterfall ui-header">
		<ul class="nav nav-list pull-left hidden-md hidden-lg">
			<li>
				<a data-toggle="menu" href="#ui_menu">
					<span class="icon icon-lg">menu</span>
				</a>
			</li>
		</ul>
		<span class="header-logo header-affix visible-md-block visible-lg-block margin-right-no" data-offset-top="0" data-spy="affix">
			<p class="pagetitle">单调队列</p>
		</span>
		
		<ul class="nav nav-list pull-right">
			<li>
				<a data-toggle="menu" href="/">
					<span class="avatar avatar-sm"><img alt="blue" src="https://i.loli.net/2017/10/21/59eb6654682d2.png"></span>
				</a>
			</li>
		</ul>
	</header>
	<main class="content">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-lg-offset-3 col-md-10 col-md-offset-1">
					<section class="content-inner margin-top-no">
						<br>
						
<h1>单调队列</h1>
<div class="card"><div class="card-main"><div class="card-inner">
<p>之前听松爷扯过单调队列，于是学了一番，感受是这样的：<br />
<img style="max-width:100%" alt="妙啊" src="https://i2.piimg.com/4851/f2e0226cc0952c5d.jpg" /><br />
单调队列大法好，<mathjax>$O(n \log n)$</mathjax>变<mathjax>$O(n)$</mathjax>！  </p>
</div></div></div>
<h2>性质</h2>
<p>单调队列，顾名思义，是一个“单调”的队列。<br />
如何便是单调？单调递增/递减。<strong>假设下面说的都是单调递减队列。</strong></p>
<p><strong>插入元素时，如何维护单调队列的单调性？</strong>
这是单调队列中最基础的问题。  <br />
解决方法往往很粗暴：<strong>先把队尾所有小于插入元素的都删除</strong>，然后插入元素。
这样就有序了。但是有个问题，为什么可以直接删除那些元素？</p>
<p>与要维护的东西的性质有关。</p>
<p>显然，我是懒得手打循环队列的。上STL大法——<strong>双端队列</strong>。</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;deque&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">deque</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">q</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>             <span class="c1">//队首插入1</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>         <span class="c1">//滋磁随机访问！</span>
    <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>              <span class="c1">//队尾插入2</span>
    <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>              <span class="c1">//队尾插入3</span>
    <span class="n">q</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>                <span class="c1">//弹出队尾元素</span>
<span class="p">}</span>
</pre></div>


<h2>例题：滑动窗口</h2>
<p>一个长度为<mathjax>$n$</mathjax>的序列，有一个长度为<mathjax>$k$</mathjax>窗口在其中滑动。
求出：每一个位置，窗口中元素的<strong>最大值、最小值</strong>。</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="err">窗口位置</span>                 <span class="err">最小值</span>    <span class="err">最大值</span> 
<span class="p">[</span> <span class="mi">1</span> <span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">5</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">7</span>   <span class="o">-</span><span class="mi">1</span>      <span class="mi">3</span> 
<span class="mi">1</span> <span class="p">[</span> <span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">3</span> <span class="p">]</span> <span class="mi">5</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">7</span>   <span class="o">-</span><span class="mi">3</span>      <span class="mi">3</span> 
<span class="mi">1</span> <span class="mi">3</span> <span class="p">[</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">5</span> <span class="p">]</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">7</span>   <span class="o">-</span><span class="mi">3</span>      <span class="mi">5</span> 
<span class="mi">1</span> <span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="p">[</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">5</span> <span class="mi">3</span> <span class="p">]</span> <span class="mi">6</span> <span class="mi">7</span>   <span class="o">-</span><span class="mi">3</span>      <span class="mi">5</span> 
<span class="mi">1</span> <span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">3</span> <span class="p">[</span> <span class="mi">5</span> <span class="mi">3</span> <span class="mi">6</span> <span class="p">]</span> <span class="mi">7</span>   <span class="mi">3</span>       <span class="mi">6</span> 
<span class="mi">1</span> <span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">5</span> <span class="p">[</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">7</span> <span class="p">]</span>   <span class="mi">3</span>       <span class="mi">7</span> 
</pre></div>


<h3>暴力</h3>
<p>想题先想暴力？</p>
<p>对于每个窗口位置，暴力求最大最小值。
复杂度<mathjax>$O(n*k)$</mathjax>。</p>
<h3>平衡树</h3>
<p>考虑优化上面的暴力。
根据滑动窗口的性质，<strong>每次移动只有一个元素进入、一个元素弹出。</strong>  </p>
<p>由此，维护一个平衡树，储存<strong>元素的出现次数</strong>。取最大/最小值输出，窗口移动时删除左边元素、加入右边元素。</p>
<p>可以用STL的multiset（可重复集合）来处理。
复杂度<mathjax>$O(n \log n)$</mathjax></p>
<h3>单调队列</h3>
<p>首先，我们只考虑<strong>最大值</strong>。最小值是类似的。窗口在移动，我们需要维护窗口中的最大值。</p>
<p>考虑下面的事实：如果有<mathjax>$l&lt;i&lt;j&lt;r$</mathjax>，则如果<mathjax>$a_i$</mathjax>可选，那么<mathjax>$a_j$</mathjax>也可选。<br />
这是很显然的。窗口在向右移动，<mathjax>$a_i$</mathjax>在<mathjax>$a_j$</mathjax>的左边，因此<mathjax>$a_i$</mathjax>比<mathjax>$a_j$</mathjax>先弹出窗口。</p>
<p>继续思考，如果<mathjax>$a_i&lt;a_j$</mathjax>，因为在<mathjax>$a_i$</mathjax>可选的情况下<mathjax>$a_j$</mathjax>可选，所以一定不会选择较小值<mathjax>$a_i$</mathjax>。可以直接删除<mathjax>$a_i$</mathjax>。</p>
<p>那么容易想到用<strong>单调递减队列</strong>维护最大值。做法：
1. 查询。直接输出队首元素。
2. 插入右端点。根据刚才想到的性质，弹出所有<strong>小于</strong>右端点的元素，然后把右端点加入。</p>
<p>最棘手的问题，如何删除左端点？ <br />
我们知道如何删除堆中的元素：另建一个堆，将<strong>准备删除</strong>的元素放进删除堆；如果删除堆和原堆的堆顶相同，则各自弹出堆顶。<br />
上面的方法的思想是，不去直接找到元素删除，而是当那个元素<strong>准备使用时</strong>删除。</p>
<p>推广到这个单调队列上。容易想到：<strong>有用的元素一定在<mathjax>$[l,r]$</mathjax>内</strong>。<br />
因此，<strong>处理队首元素时，当队首元素在<mathjax>$[l,r]$</mathjax>之外，直接弹出它，直到队首元素在<mathjax>$[l,r]$</mathjax>内为止。</strong></p>
<p>如何计算复杂度？<strong>每个元素入队一次、出队一次</strong>，因此处理每一个元素的复杂度是<mathjax>$O(1)$</mathjax>，总复杂度是<mathjax>$O(n)$</mathjax>。</p>
						
					</section>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-6 col-lg-offset-3 col-md-10 col-md-offset-1">
					<section class="content-inner margin-top-no">
						<hr>
						
							CC0协议 @ ruanxingzhi 2017.
						<a style="float:right" href="/CC0.html">CC0是啥玩意?</a>
					</section>
				</div>
			</div>

			<!-- UY BEGIN -->
			<div id="uyan_frame"></div>
			<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2128300"></script>
			<!-- UY END -->


		</div>


	</main>
	
	<div class="fbtn-container">
		<div class="fbtn-inner">
			<a class="fbtn fbtn-lg fbtn-brand-accent waves-attach waves-circle waves-light" data-toggle="dropdown">
				<span class="fbtn-text fbtn-text-left">Home</span>
				<span class="fbtn-ori icon">apps</span>
				<span class="fbtn-sub icon">close</span>
			</a>
			<div class="fbtn-dropup">
				<a class="fbtn waves-attach waves-circle" href="/about.html" target="_blank">
					<span class="fbtn-text fbtn-text-left">关于作者</span><span class="icon">perm_identity</span>
				</a>
				<a class="fbtn waves-attach waves-circle" href="https://coding.net/u/ruanxingzhi/p/blog/topic" target="_blank">
					<span class="fbtn-text fbtn-text-left">反馈</span><span class="icon">feedback</span>
				</a>
				<a class="fbtn fbtn-green waves-attach waves-circle" href="/" target="_self">
					<span class="fbtn-text fbtn-text-left">返回主页</span><span class="icon">home</span>
				</a>
			</div>
		</div>
	</div>

	

	<!-- js -->
	<script src="/js/jquery.min.js"></script>
	<script src="/js/base.min.js"></script>
</body>
</html>